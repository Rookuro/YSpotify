

const client_id = 'e5196a4107a54a1e89807459d6d9a10d';
const redirect_uri = 'http://localhost:8888/callback';
const client_secret = 'f56cc1bc736142708bf6b8fa4c930964';

app.get('/login', function(req, res) {
    const state = generateRandomString(16);
    const scope = 'user-read-private user-read-email';

    res.redirect('https://accounts.spotify.com/authorize?' +
        querystring.stringify({
            response_type: 'code',
            client_id: client_id,
            scope: scope,
            redirect_uri: redirect_uri,
            state: state
        }));
});

app.get('/callback', function(req, res) {
    const code = req.query.code || null;
    const state = req.query.state || null;

    if (state === null) {
        res.redirect('/#' +
            stringify({
                error: 'state_mismatch'
            }));
    } else {
        const authOptions = {
            url: 'https://accounts.spotify.com/api/token',
            form: {
                code: code,
                redirect_uri: redirect_uri,
                grant_type: 'authorization_code'
            },
            headers: {
                'content-type': 'application/x-www-form-urlencoded',
                'Authorization': 'Basic ' + (new Buffer.from(client_id + ':' + client_secret).toString('base64'))
            },
            json: true
        };
    }
});


const { pseudo, password } = req.body;

    const user = datauser.find(user => user.pseudo === pseudo && user.password === password );

    if (user) {
        const token = jwt.sign({ id: user.id, pseudo: user.pseudo}, privateKey, {algorithm: 'RS256', expiresIn: '1h'});
        res.set('Authorization', `Bearer ${token}`);

    } else {
        res.status(401).send("Erreur");
    }

    Peter Authorization : Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJwc2V1ZG8iOiJwZXRlciIsImlkIjoiZGNiOWUzM2YtYWRmMC00YjdiLTk5ZDQtMjIxMmE3ODk0YWUzIiwiaWF0IjoxNzA5MDIxNjIyLCJleHAiOjE3MDkwMjUyMjJ9.mD6S623_PBrfgpk1OH-ZiCNCIsjSWoYa0mtlw2TXEgsQW12nEQy7ZSsTgGEkqdr509Z9M6c6N9Of5Sw8ssR6M6hkpljQk6m_p2icPsxP1Ptnd6E7jmaMe8BAZyGkbOrdWW_JAFapOURaFang9_FD93r4DBIsRJxA-bHrclMzFh5gijk-_HiqxoPSvIFPPSMS9jYbXcAWTEp9zvJmrWHtLXTMfkkztwna5wwfGV7jPrhhapPAtL5GtJuUIxVYk5x9ii6dRr977JVdync0Gh_WNFGy26-1zdHfc0TOuY0Yj0fzwWm01y5w9_OfXsiMN2Bd7NtqvN3X3rnEsYITtSnV_Q
    Tim Authorization : Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJwc2V1ZG8iOiJ0aW0iLCJpZCI6Ijk3NTFkYWJiLWVmNTktNDA1Mi04YTAxLWRiZTA1ZmFkNTg3MSIsImlhdCI6MTcwOTAyMjc4MCwiZXhwIjoxNzA5MDI2MzgwfQ.ZS0tRGnMv5m24_o0xnGAs7mxfOEolDegZ7kdU_5x0rj3wdAzoMBtlkD4HvnJY-EXIjVLsTu0IspK40u8A1vGzT64iC4JrrdNvEfGENIWNpB5RxTISQz3XqW0pcowZfTfyuNCCmafoEppVihcold5ojqvlo_iPvsQtkhsnrKrAFyyjt8UaIjD7iJ-MFE_vnVUOS0II8G2bFtR5Ve9yEfRoz1kc7zcWNxiZhngY3q8mnQPNKkgSEHvgHBMrp_Bx2Wy0wHx4ob9bniXZ4NIRongkRhTftN_qbMKl7J-90Faay6N4L-A5oB-8bX4S5YdhI04kK0WGxpqSJ4zxj6i0TusSw